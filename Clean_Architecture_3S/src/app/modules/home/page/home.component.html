<div id="content" class="container">
  <form [formGroup]="registrationForm" (ngSubmit)="onSubmit()">
    <div class="row mb-3">
      <div class="col-md-4">
        <label for="firstName" class="form-label">First Name</label>
        <input id="firstName" formControlName="firstName" class="form-control">
        <div
          *ngIf="registrationForm.get('firstName').invalid && (registrationForm.get('firstName').dirty || registrationForm.get('firstName').touched)"
          class="text-danger">
          <small *ngIf="registrationForm.get('firstName').hasError('required')">First Name is required.</small>
          <small *ngIf="registrationForm.get('firstName').hasError('maxlength')">Max length is 20 characters.</small>
          <small *ngIf="registrationForm.get('firstName').hasError('pattern')">Only Arabic or English letters and spaces
            are allowed.</small>
        </div>
      </div>

      <div class="col-md-4">
        <label for="middleName" class="form-label">Middle Name</label>
        <input id="middleName" formControlName="middleName" class="form-control">
        <div
          *ngIf="registrationForm.get('middleName').invalid && (registrationForm.get('middleName').dirty || registrationForm.get('middleName').touched)"
          class="text-danger">
          <small *ngIf="registrationForm.get('middleName').hasError('maxlength')">Max length is 40 characters.</small>
          <small *ngIf="registrationForm.get('middleName').hasError('pattern')">Only Arabic or English letters and
            spaces are allowed.</small>
        </div>
      </div>

      <div class="col-md-4">
        <label for="lastName" class="form-label">Last Name</label>
        <input id="lastName" formControlName="lastName" class="form-control">
        <div
          *ngIf="registrationForm.get('lastName').invalid && (registrationForm.get('lastName').dirty || registrationForm.get('lastName').touched)"
          class="text-danger">
          <small *ngIf="registrationForm.get('lastName').hasError('required')">Last Name is required.</small>
          <small *ngIf="registrationForm.get('lastName').hasError('maxlength')">Max length is 20 characters.</small>
          <small *ngIf="registrationForm.get('lastName').hasError('pattern')">Only Arabic or English letters and spaces
            are allowed.</small>
        </div>
      </div>
    </div>

    <div class="row mb-3">
      <div class="col-md-4">
        <label for="birthDate" class="form-label">Birth Date</label>
        <input type="date" id="birthDate" formControlName="birthDate" class="form-control">
        <div
          *ngIf="registrationForm.get('birthDate').invalid && (registrationForm.get('birthDate').dirty || registrationForm.get('birthDate').touched)"
          class="text-danger">
          <small *ngIf="registrationForm.get('birthDate').hasError('required')">Birth Date is required.</small>
          <small *ngIf="registrationForm.get('birthDate').hasError('minAge')">Minimum age is 20 years.</small>
        </div>
      </div>

      <div class="col-md-4">
        <label for="mobileNumber" class="form-label">Mobile Number</label>
        <input id="mobileNumber" formControlName="mobileNumber" class="form-control">
        <div
          *ngIf="registrationForm.get('mobileNumber').invalid && (registrationForm.get('mobileNumber').dirty || registrationForm.get('mobileNumber').touched)"
          class="text-danger">
          <small *ngIf="registrationForm.get('mobileNumber').hasError('required')">Mobile Number is required.</small>
          <small *ngIf="registrationForm.get('mobileNumber').hasError('pattern')">Format example +021006158123.</small>
        </div>
      </div>

      <div class="col-md-4">
        <label for="email" class="form-label">Email</label>
        <input id="email" formControlName="email" class="form-control">
        <div
          *ngIf="registrationForm.get('email').invalid && (registrationForm.get('email').dirty || registrationForm.get('email').touched)"
          class="text-danger">
          <small *ngIf="registrationForm.get('email').hasError('required')">Email is required.</small>
          <small *ngIf="registrationForm.get('email').hasError('email')">Invalid email.</small>
        </div>
      </div>
    </div>

    <div id="content" class="container">
      <form [formGroup]="currentAdd">
        <h4>Add Addresses</h4>

        <div class="row mb-3">
          <div class="col-md-4">
            <label for="governate" class="form-label">Governate</label>
            <select id="governate" formControlName="governate" class="form-control"
              (change)="getetallcitiesbygovernorateid($event)">
              <option selected value=null>--Select Governate</option>
              <option *ngFor="let gov of governates" [value]="gov.id">{{gov.name}}</option>
            </select>
            <div
              *ngIf="currentAdd?.get('governate').invalid && (currentAdd?.get('governate').dirty || currentAdd?.get('governate').touched)"
              class="text-danger">
              <small *ngIf="currentAdd?.get('governate').hasError('required')">Governate is required.</small>
            </div>
          </div>

          <div class="col-md-4">
            <label for="city" class="form-label">City</label>
            <select id="city" formControlName="cityId" class="form-control">
              <option selected value=null>--Select City</option>
              <option *ngFor="let city of currentcities" [value]="city.id">{{city.name}}</option>
            </select>
            <div
              *ngIf="currentAdd?.get('cityId').invalid && (currentAdd?.get('cityId').dirty || currentAdd?.get('cityId').touched)"
              class="text-danger">
              <small *ngIf="currentAdd?.get('cityId').hasError('required')">City is required.</small>
            </div>
          </div>

          <div class="col-md-4">
            <label for="street" class="form-label">Street</label>
            <input id="street" formControlName="street" class="form-control">
            <div
              *ngIf="currentAdd?.get('street').invalid && (currentAdd?.get('street').dirty || currentAdd?.get('street').touched)"
              class="text-danger">
              <small *ngIf="currentAdd?.get('street').hasError('required')">Street is required.</small>
              <small *ngIf="currentAdd?.get('street').hasError('maxlength')">Max length is 200 characters.</small>
            </div>
          </div>
        </div>

        <div class="row mb-3">
          <div class="col-md-4">
            <label for="buildingNumber" class="form-label">Building Number</label>
            <input id="buildingNumber" formControlName="buildingNumber" class="form-control">
            <div
              *ngIf="currentAdd?.get('buildingNumber').invalid && (currentAdd?.get('buildingNumber').dirty || currentAdd?.get('buildingNumber').touched)"
              class="text-danger">
              <small *ngIf="currentAdd?.get('buildingNumber').hasError('required')">Building Number is required.</small>
            </div>
          </div>

          <div class="col-md-4">
            <label for="flatNumber" class="form-label">Flat Number</label>
            <input id="flatNumber" formControlName="flatNumber" class="form-control">
            <div
              *ngIf="currentAdd?.get('flatNumber').invalid && (currentAdd?.get('flatNumber').dirty || currentAdd?.get('flatNumber').touched)"
              class="text-danger">
              <small *ngIf="currentAdd?.get('flatNumber').hasError('required')">Flat Number is required.</small>
            </div>
          </div>
        </div>
      </form>
      <button type="button" class="btn btn-primary" (click)="addAddress()">Add Address</button>

    </div>

    <table class="table mt-4">
      <thead>
        <tr>
          <th>Governate</th>
          <th>City</th>
          <th>Street</th>
          <th>Building Number</th>
          <th>Flat Number</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody formArrayName="addresses">
        <tr *ngFor="let address of addresses.controls; let i=index" [formGroupName]="i">
          <td>
            <label>{{getGovernorateName(address?.get('governate')?.value)}}</label>
          </td>
          <td>
            <label>{{getCityName(address?.get('cityId')?.value)}}</label>
          </td>
          <td>
            <label>{{address?.get('street')?.value}}</label>
          </td>
          <td>
            <label>{{address?.get('buildingNumber')?.value}}</label>
          </td>
          <td>
            <label>{{address?.get('flatNumber')?.value}}</label>
          </td>
          <td>
            <button type="button" class="btn btn-danger btn-sm" (click)="removeAddress(i)">Remove</button>
          </td>
        </tr>
      </tbody>
    </table>

    <button type="submit" class="btn btn-success">Submit</button>
  </form>
</div>